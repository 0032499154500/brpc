#!/bin/bash
if [ -z "$1" ]; then
    echo "Usage: patch_from_svn some.patch"
    echo "The patch should be generated by 'svn diff -c <REV>'"
    exit 1
fi
cat $1 |sed -e 's/src\/baidu\/rpc\//brpc\//g' \
            -e 's/<\(bvar\/[^>]*\)>/"\1"/g' \
            -e 's/<\(base\/[^>]*\)>/"\1"/g' \
            -e 's/<\(bthread\/[^>]*\)>/"\1"/g' \
            -e 's/<\(mcpack2pb\/[^>]*\)>/"\1"/g' \
            > $1.brpc_os
EXTRA_ARGS=
if [ -z "$DO_RUN" ]; then
    EXTRA_ARGS="--dry-run $EXTRA_ARGS"
    echo "*** This is a dry-run. To really apply, run: DO_RUN=1 tools/patch_from_svn $1"
fi
patch -p0 -u $EXTRA_ARGS < $1.brpc_os
